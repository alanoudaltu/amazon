
select /* query_templates/query08.tpl.0 !CF:IR-c4b99a30-f08a-11e9-b661-06872b3fecc8..stream-query.streams-0000.i0008.1.0:CF! */  s_store_name
      ,sum(ss_net_profit)
 from public.store_sales
     ,public.date_dim
     ,public.store,
     (select ca_zip
     from (
      SELECT substring(ca_zip,1,5) ca_zip
      FROM public.customer_address
      WHERE substring(ca_zip,1,5) IN (
                          '60317','20987','54464','33890','70096','23315',
                          '16158','72411','79083','35668','23700',
                          '72369','11998','26207','70229','19656',
                          '18757','32652','21863','89887','34888',
                          '69904','89916','11473','60371','93518',
                          '71167','15485','43399','86242','22979',
                          '83760','68304','35811','54901','46361',
                          '45807','13349','48498','44248','60801',
                          '60946','80930','28674','94068','63443',
                          '75090','63556','22445','60029','21097',
                          '65943','18183','90816','42269','20706',
                          '30793','40066','12996','12115','83595',
                          '42689','26712','79768','27261','22001',
                          '68946','74652','96878','91119','84461',
                          '33613','94887','14074','64635','18715',
                          '81753','30097','66428','59309','91808',
                          '56868','61606','70644','66928','56946',
                          '75841','99430','97439','73667','53923',
                          '39531','64655','60240','46988','43082',
                          '46353','13776','17746','45892','81834',
                          '18175','55819','56858','32100','42948',
                          '82577','50631','35041','44629','75885',
                          '49815','13422','92340','28355','22559',
                          '85049','57048','62469','97256','42488',
                          '35939','39330','41203','88527','60077',
                          '49175','68607','26734','16870','51896',
                          '86386','58043','20339','92992','43231',
                          '32195','38491','64192','49259','94767',
                          '49286','90191','50213','47532','55234',
                          '50857','30427','77340','30262','69194',
                          '44478','57747','10583','34815','91305',
                          '44138','92242','55132','39331','83260',
                          '90459','14072','45099','57757','87762',
                          '63324','29578','55732','95401','92031',
                          '21683','82492','27942','16180','22089',
                          '31771','48684','81249','50459','73815',
                          '41004','38803','73330','46174','56227',
                          '68110','83420','36336','68162','28364',
                          '20683','69482','20184','36719','24116',
                          '94649','47574','49304','89697','71151',
                          '63573','56198','70222','27900','15779',
                          '92839','97478','15498','79194','20658',
                          '97243','14397','99216','81013','60138',
                          '75811','90077','70487','31705','46521',
                          '40131','80054','21772','14714','79598',
                          '75157','55784','12342','86002','65914',
                          '10595','85355','30728','47828','30664',
                          '64163','28336','17526','39542','55333',
                          '33381','48872','38010','99514','24390',
                          '59998','38197','34148','85658','60598',
                          '28913','12504','26953','92599','53358',
                          '13036','62657','33107','46343','63586',
                          '32953','34082','95633','11052','86885',
                          '48721','10263','56974','80254','11968',
                          '21609','37071','22427','75538','92853',
                          '32363','88833','67903','24706','11134',
                          '77163','90014','32043','80754','37669',
                          '19508','74078','95304','64451','15400',
                          '63971','62272','62837','30300','10889',
                          '65446','65306','39640','90761','31520',
                          '78563','20112','41546','82040','12870',
                          '76705','52203','43543','58258','43911',
                          '81456','71204','25172','95321','50425',
                          '25773','14981','18019','11457','28644',
                          '26194','99811','28931','32548','33599',
                          '62539','85827','98114','81957','24517',
                          '65157','71276','31225','98320','44132',
                          '95024','26899','31486','14190','61328',
                          '23194','47223','32785','44458','53706',
                          '57795','16799','62323','50661','41602',
                          '41854','23276','41185','14865','63357',
                          '69052','76123','37826','17927','36755',
                          '14828','16568','26334','80554','16911',
                          '68340','70791','84003','29244','25337',
                          '89306','52488','76614','43922','43409',
                          '34635','25247','75492','56071','14899',
                          '62345','36838','70470','47616','31501',
                          '19946','53714','12953','68500','33964',
                          '40846','86337','14904','12303','17988',
                          '14650','44484','37857','62960')
     intersect
      select ca_zip
      from (SELECT substring(ca_zip,1,5) ca_zip,count(*) cnt
            FROM public.customer_address, public.customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 1999
  and (substring(s_zip,1,2) = substring(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
