
select /* query_templates/query08.tpl.0 !CF:IR-c4b99a30-f08a-11e9-b661-06872b3fecc8..stream-query.streams-0008.i0008.1.0:CF! */  s_store_name
      ,sum(ss_net_profit)
 from public.store_sales
     ,public.date_dim
     ,public.store,
     (select ca_zip
     from (
      SELECT substring(ca_zip,1,5) ca_zip
      FROM public.customer_address
      WHERE substring(ca_zip,1,5) IN (
                          '99570','84339','50653','25430','28421','33889',
                          '77597','36224','88512','55327','42381',
                          '45222','47989','15553','41094','60954',
                          '40519','98969','92510','13969','86039',
                          '34397','19559','59307','56056','98020',
                          '20882','34010','84108','22420','70617',
                          '38752','22510','95776','73342','65306',
                          '29088','56680','85033','19010','57702',
                          '70129','86589','32273','12319','75314',
                          '87598','96907','10559','64458','97864',
                          '86552','10620','68392','10130','81200',
                          '36938','29144','38420','56670','65664',
                          '74361','26753','47238','37399','85194',
                          '11739','12840','45893','45652','74572',
                          '65972','95317','23890','27980','91735',
                          '32419','28625','46154','44714','65437',
                          '88285','11233','56891','84394','83225',
                          '90574','28844','78957','52969','29101',
                          '11236','82518','83084','85098','33955',
                          '11347','14700','55312','47048','89456',
                          '11913','91840','76296','77135','76992',
                          '11411','52005','86016','81699','38705',
                          '23909','35248','42531','48542','76416',
                          '31303','62304','56303','99719','35705',
                          '96589','21021','82999','43137','59477',
                          '20966','23176','82873','57621','18667',
                          '42907','61930','15050','44044','52583',
                          '47327','74316','18708','92920','33093',
                          '71307','49276','66092','58281','68347',
                          '22811','89788','69694','51119','53028',
                          '95523','80019','77260','46536','56151',
                          '13460','49370','69965','62673','99677',
                          '89690','98497','52244','10400','50935',
                          '50075','10920','39870','41722','50868',
                          '78783','30934','92675','98499','17547',
                          '51765','59046','94914','16604','63013',
                          '49143','34603','46653','77358','17768',
                          '46847','51375','31198','39197','47155',
                          '31880','77094','30607','39690','45735',
                          '50285','15013','50898','65438','11777',
                          '28149','66429','13396','72141','20968',
                          '59549','50351','14181','69104','26765',
                          '49667','45640','85900','94678','78115',
                          '86034','93247','21993','66603','15673',
                          '36342','62278','27795','77234','78910',
                          '20181','33555','61970','85674','69447',
                          '70816','91432','52789','33689','42184',
                          '92671','59028','19649','79998','51259',
                          '26200','54879','91782','58424','83982',
                          '67121','65647','44563','61576','41659',
                          '86601','89246','50954','14464','87530',
                          '98994','95281','41862','74128','33576',
                          '93225','31230','59486','11193','67327',
                          '48923','70171','63475','34934','16039',
                          '36101','11538','62096','35377','85678',
                          '92616','60852','88469','58700','99639',
                          '36865','37743','87723','38771','26295',
                          '93861','22504','38306','82314','90215',
                          '32119','55602','44087','19106','26631',
                          '12993','15966','90386','49608','95987',
                          '20878','45552','58484','86970','21431',
                          '79273','83841','84395','51771','44612',
                          '33150','67110','33730','46686','92946',
                          '92250','42625','56557','85410','15409',
                          '72342','28633','31073','17279','70592',
                          '72945','66173','91603','45355','78900',
                          '17212','79731','41020','30420','62468',
                          '22359','66013','42892','82660','59742',
                          '23955','93258','54431','37381','80273',
                          '31642','41002','72518','15159','16340',
                          '44787','27043','69661','61147','12861',
                          '64517','58510','37224','52225','97729',
                          '92046','60531','92965','68546','52909',
                          '25091','26202','37618','72183','86545',
                          '11410','36040','27513','97475','59265',
                          '77196','82847','63776','57307','69741',
                          '64320','87336','24765','23648','97424',
                          '49794','23921','35746','30658','16155',
                          '51327','88903','99884','34580','46292',
                          '87397','61910','15452','85834')
     intersect
      select ca_zip
      from (SELECT substring(ca_zip,1,5) ca_zip,count(*) cnt
            FROM public.customer_address, public.customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2000
  and (substring(s_zip,1,2) = substring(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
