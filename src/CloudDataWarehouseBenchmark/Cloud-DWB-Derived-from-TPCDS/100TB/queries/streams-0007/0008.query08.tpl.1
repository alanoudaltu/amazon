
select /* query_templates/query08.tpl.0 !CF:IR-c4b99a30-f08a-11e9-b661-06872b3fecc8..stream-query.streams-0007.i0008.1.0:CF! */  s_store_name
      ,sum(ss_net_profit)
 from public.store_sales
     ,public.date_dim
     ,public.store,
     (select ca_zip
     from (
      SELECT substring(ca_zip,1,5) ca_zip
      FROM public.customer_address
      WHERE substring(ca_zip,1,5) IN (
                          '76808','32047','84575','85567','94246','97490',
                          '47668','30449','86494','89955','93439',
                          '86131','69251','15123','45294','49549',
                          '39343','41857','61894','48173','55909',
                          '73367','11667','51772','38520','42730',
                          '24531','80966','17132','61363','50337',
                          '81372','14020','49819','72352','45032',
                          '41691','32311','75859','61861','49192',
                          '17277','38388','17194','45771','11720',
                          '20450','44494','22567','11716','83134',
                          '70189','89747','97084','21533','92163',
                          '70223','18051','46109','33892','95573',
                          '88047','87307','19331','40122','40157',
                          '40844','95764','29692','42523','11453',
                          '65182','10101','11627','70162','85238',
                          '26467','98568','26829','74717','48167',
                          '21744','86540','47485','26521','55429',
                          '61663','98324','66039','69658','58614',
                          '13349','26165','56429','77932','75030',
                          '22033','46164','16502','35628','72315',
                          '17402','79069','10002','12242','45852',
                          '97801','73887','24479','58896','77061',
                          '25521','42329','65715','36307','47303',
                          '62306','19108','42706','76379','63258',
                          '56402','59361','16993','63459','58230',
                          '87529','77946','16905','85845','52204',
                          '12249','58740','82878','69315','27317',
                          '62711','91865','93344','19086','11026',
                          '13352','87161','53458','26512','82655',
                          '95175','75319','73176','80751','93192',
                          '42989','88248','69907','82392','27847',
                          '98248','66722','35708','97680','39443',
                          '81488','46774','11213','14549','81721',
                          '61129','34891','46382','39030','90033',
                          '54916','58994','65792','65216','67765',
                          '15470','14975','45334','51615','83668',
                          '27073','34276','18540','64580','97358',
                          '23783','45401','74481','84778','38618',
                          '29007','38443','51490','64088','30241',
                          '83172','27066','79654','66409','87559',
                          '49249','75879','26645','99127','68597',
                          '64234','65984','46643','84013','96514',
                          '22055','32601','88438','44665','25178',
                          '51761','16638','45202','65919','26286',
                          '60867','98223','95434','20158','28611',
                          '83142','45508','87130','75547','78412',
                          '35317','75387','42176','85584','31422',
                          '75958','66101','56173','48326','15222',
                          '28306','17323','23524','23172','54208',
                          '37988','73893','44067','52920','63817',
                          '56866','86065','25828','71075','28531',
                          '46614','28938','83855','55974','61869',
                          '18797','67419','31576','85485','69508',
                          '72707','54049','93527','33233','94163',
                          '53384','32674','86249','68395','74731',
                          '84786','18753','87507','93317','75194',
                          '19488','37336','41053','42293','70068',
                          '13383','11272','56643','21530','44358',
                          '78207','97284','11946','41563','77702',
                          '75701','89103','67224','17360','72438',
                          '93509','14876','69854','85408','63280',
                          '88758','52105','40698','77592','64889',
                          '37565','74758','69504','81738','87346',
                          '96617','77958','94036','79765','53729',
                          '77620','52887','92646','88455','43132',
                          '38266','92391','18877','10113','42887',
                          '47622','19997','61285','65932','28008',
                          '95542','54467','41072','57449','19267',
                          '97364','87878','96152','43713','29838',
                          '30833','93748','34702','79595','73226',
                          '85336','55751','11168','23947','43948',
                          '97074','22279','77132','71926','12125',
                          '60702','29218','81682','71911','43201',
                          '59737','84277','57336','98994','66400',
                          '16817','86601','46256','38344','68788',
                          '34440','53834','18157','88221','67998',
                          '90201','62153','46334','33526','69249',
                          '85732','15635','34841','64919','48907',
                          '41122','37695','35786','56537','30138',
                          '35590','94771','96443','78788')
     intersect
      select ca_zip
      from (SELECT substring(ca_zip,1,5) ca_zip,count(*) cnt
            FROM public.customer_address, public.customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2000
  and (substring(s_zip,1,2) = substring(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
